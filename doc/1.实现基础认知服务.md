# 使用 Azure 认知服务翻译基础文本

## 什么是 **Azure 认知服务**?

**Azure 认知服务**是 API、SDK 和服务，可帮助开发人员生成智能应用程序，而无需具备直接的 AI 或数据科学技能或知识。简单来说, 开发人员可以通过对**Azure 认知服务**的调用实现一些通用的 AI 功能。

针对我们当前的应用场景，我们使用的会是**Azure 认知服务**中的`语言 API->文本翻译`。

## 大致的功能设计实现

![这里会是一张MSDN文档翻译的截图](https://link)

相关的功能点:

- 页面提供文本框，可以输入一段 markdown 文本或一个 markdown 文件的 url。
- 页面提供一个展示部分，可以预览 markdown 渲染后的 html
  - 渲染后的 html 部分，文本内容支持鼠标hover
  - hover 内容高亮并展示翻译后的内容，翻译内容在 html 渲染后异步加载
  - 代码块内容不参与翻译

实现功能的两个思路：

- [ ] 整体翻译html:
  - 优点：超级方便
  - 缺点：难以豁免部分内容(代码块)
- [x] 按节点翻译innerText
  - 优点：便于根据节点豁免内容
  - 缺点：编码麻烦

## Rock & Roll

### 第一步：注册一个国际版 Azure 订阅

不详细说明，不过有几个点需要说一下:

1. 必须是国际版 Azure，国内版本的认知服务暂时没有`语言 API`
2. 国际版 Azure 订阅绑定的微软账号不能使用RMB作为主要货币，且主要货币类型无法修改，你需要**代入非中国人的身份**来注册一个微软账号（你懂的~）。

### 第二步：开通文本翻译 API

![创建文本翻译 API](../create translate api.png)

1. [点此创建文本翻译 API](https://portal.azure.com/#create/Microsoft.CognitiveServicesTextTranslation)（如果你已经有 Azure 订阅的话）。
2. 在资源面板找到你新创建的文本翻译 API。
3. 获取文本翻译 API Key，拥有合法的Key 才能调用 API。

![查看文本翻译 API Key](../create translate api.png)

### 第三步：准备开发环境

- IDE：VS2019
- 运行时：
    |   名称    |  版本   |    备注    |
    | :-------: | :-----: | :--------: |
    | .Net Core |  2.2+   | 安装VS2019 |
    |  Node JS  | 8.15.0+ |            |
- 技术栈：
    |     名称     | 版本  |       备注        |
    | :----------: | :---: | :---------------: |
    | Asp.Net Core |   -   | .net core web api |
    |   Angular    | 7.0+  |                   |
- 第三方依赖库
  - 前端(npm)：
    |     名称     |  版本  |       备注       |
    | :----------: | :----: | :--------------: |
    | ngx-markdown | ^7.1.4 | markdown 转 html |
  - 后端(nuget)：
    |                名称                 | 版本  |             备注             |
    | :---------------------------------: | :---: | :--------------------------: |
    | CognitiveServices.Translator.Client | 1.0.0 | 第三方封装的文本翻译 API SDK |

### 第四步：Let's Code

1. 新建一个 Asp.Net Core 的 API 项目。